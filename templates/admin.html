{% extends "base.html" %}
{% block content %}
<div class="row g-4">
  <div class="col-12 col-lg-7">
    <div class="card shadow-sm">
      <div class="card-header"><strong>Admin</strong></div>
      <div class="card-body">
        <form action="/admin" method="post" class="vstack gap-3">
          <div>
            <label for="address" class="form-label">Kaspa address</label>
            <input type="text" class="form-control" id="address" name="address" value="{{ address }}" required />
          </div>

          <div class="row g-3">
            <div class="col-6">
              <label class="form-label">Transport</label>
              <input type="text" class="form-control" value="{{ transport }}" disabled />
            </div>
            <div class="col-6"></div>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary"><i class="bi bi-save me-1"></i> Save</button>
            <a href="/" class="btn btn-secondary">Cancel</a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-5">
    <div class="card shadow-sm mb-3">
      <div class="card-header"><strong>Preview</strong></div>
      <div class="card-body">
        <code class="small d-block text-break">{{ full_url }}</code>
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-header"><strong>Status</strong></div>
      <div id="status-container" class="card-body">
        {{ status_html|safe }}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Attach SSE to keep the status live on the admin page
  (function(){
    if (!('EventSource' in window)) return;
    try {
      const es = new EventSource('/events');
      es.onmessage = (evt) => {
        const el = document.getElementById('status-container');
        if (el && typeof evt.data === 'string') el.innerHTML = evt.data;
      };
    } catch (e) {}
  })();
  </script>
{% endblock %}
